(function(){"use strict";var e={3662:function(e,t,s){var i=s(5230),n=s(3739),o=(s(5823),s(7384));function a(e,t,s,i,n,a){const r=(0,o.up)("ConfigList");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(r)])}var r=s(6899);const l=e=>((0,o.dD)("data-v-1028074d"),e=e(),(0,o.Cn)(),e),c={class:"container"},d=l((()=>(0,o._)("h3",null,"全部配置文件",-1))),f=l((()=>(0,o._)("h3",null,"新建配置文件",-1))),u=l((()=>(0,o._)("h3",null,"获取远程配置",-1)));function p(e,t,s,i,n,a){const l=(0,o.up)("el-table-column"),p=(0,o.up)("el-button"),g=(0,o.up)("el-table"),h=(0,o.up)("el-col"),m=(0,o.up)("el-row"),w=(0,o.up)("el-input"),C=(0,o.up)("el-text"),k=(0,o.up)("el-radio"),_=(0,o.up)("el-radio-group");return(0,o.wg)(),(0,o.iD)("div",c,[(0,o._)("h2",null,(0,r.zw)(n.VUE_APP_TITLE),1),(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,{span:24},{default:(0,o.w5)((()=>[d,(0,o.Wm)(g,{data:n.configs,style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{label:"配置文件名",prop:"name",width:"300"}),(0,o.Wm)(l,{label:"状态",prop:"status",width:"300"}),(0,o.Wm)(l,{label:"操作",width:"400"},{default:(0,o.w5)((e=>[(0,o.Wm)(p,{disabled:"运行中🟢"===e.row.status,type:"primary",onClick:t=>a.startProcess(e.row.name)},{default:(0,o.w5)((()=>[(0,o.Uk)("启动 ")])),_:2},1032,["disabled","onClick"]),(0,o.Wm)(p,{disabled:"运行中🟢"!==e.row.status,type:"info",onClick:t=>a.stopProcess(e.row.name)},{default:(0,o.w5)((()=>[(0,o.Uk)("停止 ")])),_:2},1032,["disabled","onClick"]),(0,o.Wm)(p,{disabled:"运行中🟢"===e.row.status,type:"warning",onClick:t=>a.showEditConfigDialog(e.row.name)},{default:(0,o.w5)((()=>[(0,o.Uk)("编辑 ")])),_:2},1032,["disabled","onClick"]),(0,o.Wm)(p,{disabled:"运行中🟢"!==e.row.status,type:"success",onClick:t=>a.showAccessLinks(e.row.name)},{default:(0,o.w5)((()=>[(0,o.Uk)("访问 ")])),_:2},1032,["disabled","onClick"]),(0,o.Wm)(p,{disabled:"运行中🟢"===e.row.status,type:"danger",onClick:t=>a.deleteConfig(e.row.name)},{default:(0,o.w5)((()=>[(0,o.Uk)("删除 ")])),_:2},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data"]),(0,o.Wm)(p,{class:"button-spacing",type:"primary",onClick:a.showCreateConfigDialog},{default:(0,o.w5)((()=>[(0,o.Uk)("新建配置文件")])),_:1},8,["onClick"]),(0,o.Wm)(p,{class:"button-spacing",type:"primary",onClick:a.getRemoteApiConfigDialog},{default:(0,o.w5)((()=>[(0,o.Uk)("获取远程配置")])),_:1},8,["onClick"])])),_:1})])),_:1}),n.showEditor?((0,o.wg)(),(0,o.j4)(m,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{span:24},{default:(0,o.w5)((()=>[f,(0,o.Wm)(w,{modelValue:n.selectedConfig,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedConfig=e),disabled:!n.isNewConfig,placeholder:"文件名",type:"text",style:{width:"1000px"},onChange:a.validateFileName},null,8,["modelValue","disabled","onChange"]),(0,o.Wm)(w,{modelValue:n.configContent,"onUpdate:modelValue":t[1]||(t[1]=e=>n.configContent=e),autosize:{minRows:10,maxRows:1/0},class:"button-spacing",style:{width:"1000px"},placeholder:"配置内容",type:"textarea"},null,8,["modelValue"]),(0,o.Wm)(h,{span:24},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"button-spacing",type:"primary",onClick:a.saveConfig},{default:(0,o.w5)((()=>[(0,o.Uk)("保存")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):(0,o.kq)("",!0),n.showapiconfig?((0,o.wg)(),(0,o.j4)(m,{key:1},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{span:24},{default:(0,o.w5)((()=>[u,(0,o.Wm)(C,{class:"mx-1",type:"danger"},{default:(0,o.w5)((()=>[(0,o.Uk)("远程访问令牌都存储在本地Cookies中")])),_:1}),(0,o.Wm)(h,{span:24},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{modelValue:n.selectedApi,"onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedApi=e),class:"ml-4"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{label:"muhanfrp",size:"large"},{default:(0,o.w5)((()=>[(0,o.Uk)("木韩FRP")])),_:1}),(0,o.Wm)(k,{label:"sakurafrp",size:"large"},{default:(0,o.w5)((()=>[(0,o.Uk)("樱花FRP")])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(h,{span:24},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{modelValue:n.apiKeys[n.selectedApi],"onUpdate:modelValue":t[3]||(t[3]=e=>n.apiKeys[n.selectedApi]=e),placeholder:"请输入API密钥",type:"password","show-password":"",style:{width:"1000px"}},null,8,["modelValue"])])),_:1}),(0,o.Wm)(h,{span:24},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"button-spacing",type:"primary",onClick:a.getRemoteApi},{default:(0,o.w5)((()=>[(0,o.Uk)("获取")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(g,{data:n.remoteConfigs,style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{label:"ID",prop:"id",width:"300"}),(0,o.Wm)(l,{label:"名称",prop:"name",width:"300"}),(0,o.Wm)(l,{label:"操作",width:"400"},{default:(0,o.w5)((e=>[(0,o.Wm)(p,{type:"primary",onClick:t=>a.downloadConfig(e.row)},{default:(0,o.w5)((()=>[(0,o.Uk)("下载")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1})):(0,o.kq)("",!0)])}s(7495);var g=s(6764),h=s(1991),m=s.n(h),w=s(9634),C={data(){return{configs:[],selectedConfig:null,configContent:"",showEditor:!1,processes:[],isNewConfig:!1,remoteConfigs:[],showapiconfig:!1,selectedApi:"",VUE_APP_TITLE:"FRPC管理器-WebUI",apiKeys:{muhanfrp:w.Z.get("muhanfrpApiKey")||"",sakurafrp:w.Z.get("sakurafrpApiKey")||""}}},methods:{getConfigs(){g.Z.get("/api/configs").then((e=>{this.configs=e.data.map((e=>{const t=this.processes.includes(e)?"运行中🟢":"已停止🔴";return{name:e,status:t}}))}))},getProcesses(){g.Z.get("/api/processes").then((e=>{this.processes=e.data,this.getConfigs()})).catch((e=>{console.error("获取数据时发生错误：",e),m().fire("Webui接口请求错误","","error")}))},showCreateConfigDialog(){this.showEditor=!0,this.selectedConfig="",this.configContent="",this.isNewConfig=!0,this.showapiconfig=!1},getRemoteApiConfigDialog(){this.showapiconfig=!0,this.showEditor=!1},showEditConfigDialog(e){this.showEditor=!0,this.showapiconfig=!1,this.selectedConfig=e,this.isNewConfig=!1,this.getConfig()},deleteConfig(e){m().fire({title:"确认",text:"你确定要删除这个配置文件吗？",icon:"warning",showCancelButton:!0,confirmButtonText:"删除",cancelButtonText:"取消"}).then((t=>{t.isConfirmed&&g.Z.delete(`/api/configs/${e}`).then((e=>{"success"===e.data.status?(this.getConfigs(),m().fire("删除成功","","success")):m().fire("删除失败",e.data.message,"error")}))}))},getConfig(){this.selectedConfig?g.Z.get(`/api/configs/${this.selectedConfig}`).then((e=>{this.configContent=e.data.content})):(this.configContent="",m().fire("请求错误","","error"))},saveConfig(){if(this.selectedConfig){const e={name:this.selectedConfig,content:this.configContent};if(this.isNewConfig)g.Z.post("/api/configs",e).then((e=>{"success"===e.data.status?(this.getConfigs(),m().fire("保存成功","","success")):m().fire("保存失败",e.data.message,"error")}));else{const t=`/api/configs/${this.selectedConfig}`;g.Z.put(t,e).then((e=>{"success"===e.data.status?(this.getConfigs(),m().fire("修改成功","","success")):m().fire("修改失败",e.data.message,"error")}))}}},startProcess(e){g.Z.post("/api/processes",{name:e}).then((e=>{"success"===e.data.status?(this.getProcesses(),m().fire("启动成功","","success")):m().fire("启动失败",e.data.message,"error")}))},stopProcess(e){m().fire({title:"确认",text:"你确定要停止这个进程吗？",icon:"warning",showCancelButton:!0,confirmButtonText:"停止",cancelButtonText:"取消"}).then((t=>{t.isConfirmed&&g.Z.delete(`/api/processes/${e}`).then((e=>{"success"===e.data.status?(this.getProcesses(),m().fire("停止成功","","success")):m().fire("停止失败",e.data.message,"error")}))}))},validateFileName(){const e=/^[\w\p{Script=Hani}.-]+(\.toml|\.ini|\.json|\.yaml)?$/u;e.test(this.selectedConfig)?this.isNewConfig&&this.configs.some((e=>e.name.split(".")[0]===this.selectedConfig.split(".")[0]))&&(m().fire("错误","文件名已存在","error"),this.selectedConfig=""):(m().fire("错误","文件名只能包含中文、字母、数字、下划线和点，如果有后缀，只能是toml、ini、json、yaml","error"),this.selectedConfig="")},getRemoteApi(){const e=this.selectedApi;console.log("当前选择的API: "+e),g.Z.get("api/get_configurations",{params:{api_channel:e,api_key:this.apiKeys[this.selectedApi]}}).then((e=>{if(e.data.length>0){this.remoteConfigs=e.data;const t=new Date;t.setFullYear(t.getFullYear()+10),w.Z.set(this.selectedApi+"ApiKey",this.apiKeys[this.selectedApi],{expires:t})}else m().fire("请求错误","","error")})).catch((()=>{m().fire("请求错误","","error")}))},downloadConfig(e){g.Z.get("/api/downloadConfig",{params:{config_id:e.id,config_name:e.name,api_key:this.apiKeys[this.selectedApi],api_channel:this.selectedApi}}).then((e=>{"success"===e.data.status?(m().fire("下载成功","","success"),this.getConfigs()):m().fire("下载失败",e.data.message,"error")})).catch((()=>{m().fire("请求错误","","error")}))},extractAccessLinks(e){const t=[],s=e.split("\n");let i="",n="",o="";for(let a=0;a<s.length;a++){const e=s[a].trim(),r=e.split("=");if(2===r.length){const e=r[0].trim();let s=r[1].trim();s=s.replace(/['"]+/g,""),"server_addr"===e||"serverAddr"===e?i=s:"remote_port"===e||"remotePort"===e?(n=s,t.push(i+":"+n)):"custom_domains"!==e&&"customDomains"!==e||(o=s,t.push(o))}}return t},showAccessLinks(e){g.Z.get(`/api/configs/${e}`).then((e=>{const t=e.data.content,s=this.extractAccessLinks(t);if(1===s.length)window.open("http://"+s[0],"_blank");else{const e=s.map((e=>`<a href="http://${e}" target="_blank">${e}</a>`)).join("<br><br>");m().fire({title:"访问地址",html:e,icon:"info"})}})).catch((()=>{m().fire("请求错误","","error")}))}},watch:{selectedApi(){this.apiKeys[this.selectedApi]&&this.getRemoteApi()}},created(){this.getProcesses()}},k=s(9015);const _=(0,k.Z)(C,[["render",p],["__scopeId","data-v-1028074d"]]);var b=_,y={components:{ConfigList:b}};const v=(0,k.Z)(y,[["render",a]]);var W=v;g.Z.defaults.baseURL="";const A=(0,i.ri)(W),x=(e,t)=>{let s=null;return function(){let i=this,n=arguments;clearTimeout(s),s=setTimeout((function(){e.apply(i,n)}),t)}},U=window.ResizeObserver;window.ResizeObserver=class extends U{constructor(e){e=x(e,16),super(e)}},A.use(n.Z),A.mount("#app")}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,i,n,o){if(!i){var a=1/0;for(d=0;d<e.length;d++){i=e[d][0],n=e[d][1],o=e[d][2];for(var r=!0,l=0;l<i.length;l++)(!1&o||a>=o)&&Object.keys(s.O).every((function(e){return s.O[e](i[l])}))?i.splice(l--,1):(r=!1,o<a&&(a=o));if(r){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[i,n,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var n,o,a=i[0],r=i[1],l=i[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(l)var d=l(s)}for(t&&t(i);c<a.length;c++)o=a[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},i=self["webpackChunkfrpc_webui"]=self["webpackChunkfrpc_webui"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[998],(function(){return s(3662)}));i=s.O(i)})();